{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _objectAssign = require('object-assign');\n\nvar _objectAssign2 = _interopRequireDefault(_objectAssign);\n\nvar _reactTweenState = require('react-tween-state');\n\nvar _reactTweenState2 = _interopRequireDefault(_reactTweenState);\n\nvar _reactAddonsTransitionGroup = require('react-addons-transition-group');\n\nvar _reactAddonsTransitionGroup2 = _interopRequireDefault(_reactAddonsTransitionGroup);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _objectWithoutProperties(obj, keys) {\n  var target = {};\n\n  for (var i in obj) {\n    if (keys.indexOf(i) >= 0) continue;\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\n    target[i] = obj[i];\n  }\n\n  return target;\n}\n/* eslint no-unused-vars:0 */\n\n/*global window, document, getComputedStyle*/\n\n\nvar Clones = _react2.default.createClass({\n  displayName: 'ShuffleClones',\n  _childrenWithPositions: function _childrenWithPositions() {\n    var _this = this;\n\n    var children = [];\n\n    _react2.default.Children.forEach(this.props.children, function (child) {\n      var style = _this.props.positions[child.key];\n      var key = child.key;\n      children.push(_react2.default.createElement(Clone, {\n        child: child,\n        style: style,\n        key: key,\n        initial: _this.props.initial,\n        fade: _this.props.fade,\n        scale: _this.props.scale,\n        duration: _this.props.duration\n      }));\n    });\n\n    return children.sort(function (a, b) {\n      return a.key < b.key ? -1 : a.key > b.key ? 1 : 0;\n    });\n  },\n  render: function render() {\n    return _react2.default.createElement('div', {\n      className: 'ShuffleClones'\n    }, _react2.default.createElement(_reactAddonsTransitionGroup2.default, null, this._childrenWithPositions()));\n  }\n});\n\nvar Clone = _react2.default.createClass({\n  mixins: [_reactTweenState2.default.Mixin],\n  displayName: 'ShuffleClone',\n  getInitialState: function getInitialState() {\n    return {\n      top: this.props.style ? this.props.style.top : 0,\n      left: this.props.style ? this.props.style.left : 0,\n      opacity: 1,\n      transform: 1\n    };\n  },\n  componentWillAppear: function componentWillAppear(cb) {\n    this.tweenState('opacity', {\n      easing: _reactTweenState2.default.easingTypes.easeOutSine,\n      duration: this.props.duration,\n      beginValue: this.props.initial ? 0 : 1,\n      endValue: 1,\n      onEnd: cb\n    });\n  },\n  componentWillEnter: function componentWillEnter(cb) {\n    this.tweenState('opacity', {\n      easing: _reactTweenState2.default.easingTypes.easeOutSine,\n      duration: this.props.duration,\n      beginValue: 0,\n      endValue: 1,\n      onEnd: cb\n    });\n  },\n  componentWillLeave: function componentWillLeave(cb) {\n    this.tweenState('opacity', {\n      easing: _reactTweenState2.default.easingTypes.easeOutSine,\n      duration: this.props.duration,\n      endValue: 0,\n      onEnd: function onEnd() {\n        try {\n          cb();\n        } catch (e) {// This try catch handles component umounting jumping the gun\n        }\n      }\n    });\n  },\n  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {\n    this.tweenState('top', {\n      easing: _reactTweenState2.default.easingTypes.easeOutSine,\n      duration: nextProps.duration,\n      endValue: nextProps.style.top\n    });\n    this.tweenState('left', {\n      easing: _reactTweenState2.default.easingTypes.easeOutSine,\n      duration: nextProps.duration,\n      endValue: nextProps.style.left\n    });\n  },\n  render: function render() {\n    var style = {};\n\n    if (this.props.style) {\n      style = {\n        top: this.getTweeningValue('top'),\n        left: this.getTweeningValue('left'),\n        opacity: this.props.fade ? this.getTweeningValue('opacity') : 1,\n        transform: this.props.scale ? 'scale(' + this.getTweeningValue('opacity') + ')' : 0,\n        transformOrigin: 'center center',\n        width: this.props.style.width,\n        height: this.props.style.height,\n        position: this.props.style.position\n      };\n    }\n\n    var key = this.props.key;\n    return _react2.default.cloneElement(this.props.child, {\n      style: style,\n      key: key\n    });\n  }\n});\n\nvar Shuffle = _react2.default.createClass({\n  displayName: 'Shuffle',\n  propTypes: {\n    duration: _react2.default.PropTypes.number,\n    scale: _react2.default.PropTypes.bool,\n    fade: _react2.default.PropTypes.bool,\n    initial: _react2.default.PropTypes.bool\n  },\n  getDefaultProps: function getDefaultProps() {\n    return {\n      duration: 300,\n      scale: true,\n      fade: true,\n      initial: false\n    };\n  },\n  getInitialState: function getInitialState() {\n    return {\n      animating: false,\n      ready: false\n    };\n  },\n  componentDidMount: function componentDidMount() {\n    this._makePortal();\n\n    window.addEventListener('resize', this._renderClonesInitially);\n  },\n  componentWillUnmount: function componentWillUnmount() {\n    _reactDom2.default.unmountComponentAtNode(this._portalNode);\n\n    _reactDom2.default.findDOMNode(this.refs.container).removeChild(this._portalNode);\n\n    window.removeEventListener('resize', this._renderClonesInitially);\n  },\n  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {\n    this._startAnimation(nextProps);\n  },\n  componentDidUpdate: function componentDidUpdate(prevProps) {\n    var _this2 = this;\n\n    if (this.state.ready === false) {\n      this.setState({\n        ready: true\n      }, function () {\n        _this2._renderClonesInitially();\n      });\n    } else {\n      this._renderClonesToNewPositions(this.props);\n    }\n  },\n  _makePortal: function _makePortal() {\n    this._portalNode = document.createElement('div');\n    this._portalNode.style.left = '0px';\n    this._portalNode.style.top = '0px';\n    this._portalNode.style.position = 'absolute';\n\n    _reactDom2.default.findDOMNode(this.refs.container).appendChild(this._portalNode);\n  },\n  _addTransitionEndEvent: function _addTransitionEndEvent() {\n    setTimeout(this._finishAnimation, this.props.duration);\n  },\n  _startAnimation: function _startAnimation(nextProps) {\n    var _this3 = this;\n\n    if (this.state.animating) {\n      return;\n    }\n\n    var cloneProps = (0, _objectAssign2.default)({}, nextProps, {\n      positions: this._getPositions(),\n      initial: this.props.initial,\n      fade: this.props.fade,\n      scale: this.props.scale,\n      duration: this.props.duration\n    });\n\n    this._renderClones(cloneProps, function () {\n      _this3._addTransitionEndEvent();\n\n      _this3.setState({\n        animating: true\n      });\n    });\n  },\n  _renderClonesToNewPositions: function _renderClonesToNewPositions(props) {\n    var cloneProps = (0, _objectAssign2.default)({}, props, {\n      positions: this._getPositions(),\n      initial: this.props.initial,\n      fade: this.props.fade,\n      scale: this.props.scale,\n      duration: this.props.duration\n    });\n\n    this._renderClones(cloneProps);\n  },\n  _finishAnimation: function _finishAnimation() {\n    this.setState({\n      animating: false\n    });\n  },\n  _getPositions: function _getPositions() {\n    var _this4 = this;\n\n    var positions = {};\n\n    _react2.default.Children.forEach(this.props.children, function (child) {\n      var ref = child.key;\n\n      var node = _reactDom2.default.findDOMNode(_this4.refs[ref]);\n\n      var rect = node.getBoundingClientRect();\n      var computedStyle = getComputedStyle(node);\n      var marginTop = parseInt(computedStyle.marginTop, 10);\n      var marginLeft = parseInt(computedStyle.marginLeft, 10);\n      var position = {\n        top: node.offsetTop - marginTop,\n        left: node.offsetLeft - marginLeft,\n        width: rect.width,\n        height: rect.height,\n        position: 'absolute',\n        opacity: 1\n      };\n      positions[ref] = position;\n    });\n\n    return positions;\n  },\n  _renderClonesInitially: function _renderClonesInitially() {\n    var cloneProps = (0, _objectAssign2.default)({}, this.props, {\n      positions: this._getPositions(),\n      initial: this.props.initial,\n      fade: this.props.fade,\n      scale: this.props.scale,\n      duration: this.props.duration\n    });\n\n    _reactDom2.default.unstable_renderSubtreeIntoContainer(this, _react2.default.createElement(Clones, cloneProps), this._portalNode);\n\n    this.setState({\n      ready: true\n    });\n  },\n  _renderClones: function _renderClones(props, cb) {\n    _reactDom2.default.unstable_renderSubtreeIntoContainer(this, _react2.default.createElement(Clones, props), this._portalNode, cb);\n  },\n  _childrenWithRefs: function _childrenWithRefs() {\n    return _react2.default.Children.map(this.props.children, function (child) {\n      return _react2.default.cloneElement(child, {\n        ref: child.key\n      });\n    });\n  },\n  render: function render() {\n    var _props = this.props,\n        initial = _props.initial,\n        fade = _props.fade,\n        duration = _props.duration,\n        props = _objectWithoutProperties(_props, ['initial', 'fade', 'duration']);\n\n    var showContainer = initial ? 0 : 1;\n\n    if (this.state.ready) {\n      showContainer = 0;\n    }\n\n    return _react2.default.createElement('div', _extends({\n      ref: 'container',\n      style: {\n        position: 'relative'\n      }\n    }, props), _react2.default.createElement('div', {\n      style: {\n        opacity: showContainer\n      }\n    }, this._childrenWithRefs()));\n  }\n});\n\nexports.default = Shuffle;","map":null,"metadata":{},"sourceType":"script"}